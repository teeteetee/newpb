doc
html(lang='en')
head
  meta(charset='utf-8')     
  meta(http-equiv='X-UA-Compatible', content='IE=edge')     
  meta(name='viewport', content='width=device-width, initial-scale=1')
  // The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags
  title P&B     
  link(rel='icon', href='', sizes='16x16', type='image/png')
  // Bootstrap
  link(href='/bootstrap/css/bootstrap.min.css', rel='stylesheet')   
  script(src="https://cdnjs.cloudflare.com/ajax/libs/slideout/0.1.9/slideout.min.js")
  link(href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css', rel='stylesheet')
  meta(liber de amicitia est)
  meta(property="og:url"           content="http://peopleandbooks.com")
  meta(property="og:type"          content="website")
  meta(property="og:title"         content="People and Books")
  meta(property="og:description"   content="List items, find people.")
  meta(property="og:image"         content="http://peopleandbooks.com/images/pb_inf_logo.png")
  // HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
  // WARNING: Respond.js doesn't work if you view the page via file://
  //if lt IE 9
  script(src='/js/share.js')
  script(src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js')
  script(src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js')     
  style.
    #panel {
    padding-top:110px;
    min-height:100vh;
    background-color:white;
    }
    body {
      width: 100%;
      height: 100%;
      font: 100%/1.4em 'Calibre Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-size:14;
    }
    .slideout-menu {
      background-color: #1D1F20;
      background-image: linear-gradient(145deg, #1D1F20, #404348);
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      right: 0;
      z-index: 0;
      width: 256px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      display: none;
    }
    .slideout-panel {
      position:relative;
      z-index: 1;
    }
    .slideout-open,
    .slideout-open body,
    .slideout-open .slideout-panel {
      overflow: hidden;
    }
    .slideout-open .slideout-menu {
      display: block;
    }
    .menu a {
      color: #fff;
    }
    .menu a:hover {
      text-decoration: underline;
    }
    .menu-header {
      border-bottom: 1px solid #2a2d2f;
      padding: 20px 0 20px 60px;
      background-size: 32px;
    }
    .menu-header-title {
      font-weight: 600;
      letter-spacing: 0.5px;
      margin: 0;
      font-size:18;
    }
    .menu-section {
      margin: 25px 0;
    }
    .menu-section-title {
      text-transform: uppercase;
      color: #85888d;
      font-weight: 200;
      font-size: 13px;
      letter-spacing: 1px;
      padding: 0 20px;
      margin:0;
    }
    .menu-section-list {
      padding:0;
      margin: 10px 0;
      list-style:none;
    }
    .menu-section-list a {
      font-family:boldproxima;
      text-transform: uppercase;
      color: #85888d;
      font-weight: 200 !important;
      font-size: 20px !important;
      letter-spacing: 1px;
      display: block;
      padding: 20px 20px;
    }
    .menu-section-list a:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color:#fff !important;
      text-decoration: none;
    }
    .menu-section-list .active a {
      background-color: rgba(255, 255, 255, 0.1);
      color:#fff !important;
      text-decoration: none;
    }
    #userimg {
    width:100%;
    max-width:200px;
    margin:30px;
    margin-left:50px;
    margin-right:50px;
    display:block;
    }
    #emptyavatar {
    width:193px;
    height:193px;
    border:7px dotted #eee;
    bakcground-color:white;
    border-radius:50%;
    }
    .emptybook {
    padding-left:23px;
    }
    .book h4 {
    color:black;
    }
    .book .col-xs-12 {
    border-bottom: 1px solid #eee;
    }
    .new{
      border-left:10px solid #333;
    }
    #booklist {
    border-top-right-radius:10px;
    border-bottom-right-radius:10px;
    }
    .list {
    overflow:auto;
    min-height:500px;
    max-height:70vh;
    text-align:center;
    padding-top:50px;
    }
    #signup {
      padding-top:50px;
      padding-bottom:100px;
    } 
    .dot-sm {
      color:#ff6f02;
      margin-right:6px;
    }
    .autocomp {
    display:none;
    background-color: white;
    border-radius: 3px;
    margin-left: 0px;
    margin-right: 0px;
    padding-top:3px;
    padding-bottom:3px;
    border: 1px solid #ddd;
    position: absolute;
    max-width: 510;
    width: 100%;
    box-shadow: 1px 7px 30px #A09F9F;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
    .sritem:hover {
     background-color:#23A8E2;
     color:white;
    }
    .sritem {
      padding-top:3px;
      padding-bottom:3px;
    }
    @media (max-width: 992px) {
    #booklist {
    border-bottom-left-radius:10px;
    }
    .things{
    padding-top:50px;
    }
    .list {
    padding-top:50px;
    }
    }
    @media (max-width: 767px) {
    #panel {
    padding-top:80px;
    }
    .autocomp {
    font-size:20px;
    width:90%;
    }
    .dot-sm {
      color:transparent;
    }
    #mainframe {
    margin-top:0px;
    }
    .new{
      border-color:#ccc;
    }
    #bigscreens .book {
    border-bottom:1px solid #eee;
    text-align:center;
    padding-left:15px;
    padding-right:15px;
    }
    .emptybook {
    margin-left:0px;
    }
    #leftpanel {
    border-right:0px;
    }
    #booklist {
    border-bottom-left-radius:10px;
    }
    
    .list {
      max-height:inherit;
    }
    .paddgroup {
    padding-left:25px;
    padding-right:25px;
    }
    #signup {
      background-color:#333;
    }
    }
    @font-face {
    font-family:roboto-thin;
    src: url('/bootstrap/fonts/Roboto-Thin.ttf');
    }
    @font-face{
    font-family:proxima;
    src:url('/bootstrap/fonts/ProximaNova-Reg-webfont.woff');
    }
    @font-face{
    font-family:boldproxima;
    src:url('/bootstrap/fonts/ProximaNova-Sbold-webfont.woff');
    }
    .thin {
    height:85%;
    }
    .inleftblock {
    border-bottom:1px solid #eee;
    color:gray;
    -webkit-transition: background-color 0.3s ease;
    -moz-transition: background-color 0.3s ease;
    -o-transition: background-color 0.3s ease;
    transition: background-color 0.3s ease;
    }
    .inleftblock:hover {
    background-color: #ddd;
    color:white;
    }
    .inleftblock:hover h4 {
    color:white;
    }
    .glyphicon {
    margin-right:5px;
    }
    .btncorr {
    font-family:boldproxima;
    text-transform:uppercase;
    }
    .img-circle {
    -webkit-filter: brightness(0.9) contrast(1.2) saturate(1.2);
    -moz-filter: brightness(0.9) contrast(1.2) saturate(1.2);
    filter:brightness(0.9) contrast(1.2) saturate(1.2);
    }
    #heyopen {
    -webkit-box-shadow: inset 0px 7px 17px -9px rgba(0,0,0,0.75);
    -moz-box-shadow: inset 0px 7px 17px -9px rgba(0,0,0,0.75);
    box-shadow: inset 0px 7px 17px -9px rgba(0,0,0,0.75);
    }
    .btn-success:hover {
    background-color:#33AF5F;
    border:1px solid #33AF5F;
    } 
    a:hover, a:focus, a:active {
      text-decoration:none !important;
      color:inherit !important;
    }
    p{
      text-indent:20px;
      font-size:18px;
    }
    .cpadding {
     padding-left:30px;
     padding-right:30px;
    }
    .txtleft {
      text-align:left;
    }
    ol li {
    margin-bottom: 10px;
    font-size:18px;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
    #extra {
      display:none;
      background-color:#f5f5f5;
      padding-top:15px;
    }
    #add {
      display:none;
    }
    button:focus,button:active {
       outline: none !important;
    }
    .btn-default:focus,.btn-default:active {
       background-color:white;
       border-color:#ccc;
    }
    .modal label {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 13;
    }
    .loader {
    margin: 60px auto;
    margin-top:20%;
    font-size: 10px;
    position: relative;
    text-indent: -9999em;
    border-top: 1.1em solid rgba(255, 255, 255, 0.2);
    border-right: 1.1em solid rgba(255, 255, 255, 0.2);
    border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
    border-left: 1.1em solid #ffffff;
    -webkit-transform: translateZ(0);
    -ms-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-animation: load8 1.1s infinite linear;
    animation: load8 1.1s infinite linear;
    }
    .loader,
    .loader:after {
      border-radius: 50%;
      width: 10em;
      height: 10em;
    }
    @-webkit-keyframes load8 {
      0% {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
      }
      100% {
        -webkit-transform: rotate(360deg);
        transform: rotate(360deg);
      }
    }
    @keyframes load8 {
      0% {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
      }
      100% {
        -webkit-transform: rotate(360deg);
        transform: rotate(360deg);
      }
    }
    #testinsert {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    .hovershade:hover{
     background-color:#eee;
    }
    .slideover {
    display:none;
    z-index:8888;
    position:absolute;
    background-color:rgba(0,0,0,0.8);
    width:100%;
    text-align:center;
    }
    .btn-darkdefault{
     background:none;
     border:1px solid #ddd;
     color:white;
    }
    .btn-darkwarning{
     background:none;
     border:1px solid #ff9900;
     color:#ff9900;
    }
    .btn-darkdanger{
     background:none;
     border:1px solid red;
     color:red;
    }
    .btn-darkprimary{
     background:none;
     border:1px solid  #00C3FF;;
     color: #00C3FF;;
    }
    .btn.focus, .btn:focus, .btn:hover {
        text-decoration: none;
    }
    .btn-default{
     border:1px solid #ccc !important;
     color:#bbb;
     background:none;
    }
    .btn-default.active {
      background-color:#ccc;
      color:white;
    }
    .btn-default:focus, .btn-default:active, .btn-default:hover {
      color:inherit;
      background-color:inherit;
    }
    .btn-success {
      border:1px solid #3ACA6D;
      background-color:#3ACA6D;
      color:white;
    }
    .btn-success:focus, .btn-success:active, .btn-success:hover {
      background-color:#2EA056;
      color:white;
    }
    .btn-iosdark {
      background-color:white;
      border:1px solid #333;
      color:#333;
    }
    .btn-iosdark:focus, .btn-iosdark:active, .btn-iosdark:hover {
      background-color:#333;
      color:white;
    }
    .btn-iosdark.active {
      background-color:#333;
      color:white;
    }
    .btn-iosdark .badge {
      background-color:#ddd;
      color:#333;
    }
    .btn-iosdark.active .badge {
      background-color:white;
      color:#333;
    }
    .modal-sm .btn-iosdark {
      box-shadow:none;
      border:none;
      background-color:#2d2d2d;
    }
    .modal-sm .btn-iosdark:hover {
      background-color:#424242;
    }
    .btn-ioslight {
      background-color:transparent;
      border:1px solid white;
      color:white;
    }
    .btn-ioslight:focus, .btn-ioslight:active, .btn-ioslight:hover {
      background-color:white;
      color:#333;
    }
    .btn-ioslight.active {
      background-color:white;
      color:#333;
    }
    .btn-iosprimary {
      background-color:white;
      border:1px solid #ff6f02;
      color:#ff6f02;
    }
    .btn-iosprimary:focus, .btn-iosprimary:active, .btn-iosprimary:hover {
      background-color:#ff6f02;
      color:white;
    }
    .btn-iosprimary.iosactive {
      background-color:#ff6f02;
      color:white;
    }
    .btn-modal:focus, .btn-modal:active, .btn-modal:hover {
     background-color: white;
     border-color: white;
     color: #FF6F02;
    }
    .btn-modal{
      background-color: white;
      border-color: white;
      color: #FF6F02;
      font-size:20px;
    }
    .btn-primary:focus, .btn-primary:active, .btn-primary:hover {
      background-color: #FF6F02;
      border-color: #FF6F02;
    }
    .btn-primary{
      background-color: #FF6F02;
      border-color: #FF6F02;
    }
    .medialeft > img {
      width:64px !important;
      height:64px !important;
    }
    #bigscreens > .book {
      max-width:1000px;
      margin:auto;
    }
    #bigscreens > .book > .bookpadding {
     padding-top:10px;
    padding-bottom:10px;
    }
    h3 {
      font-weight:200;
    }
    .read {
    }
    .btn-default .badge {
      background-color:white;
      color:#c7c6c6;
      font-weight:500;
    }
    .btn-default .active .badge {
      background-color:white;
      color:#c7c6c6;
    }
     .btn-default.active:focus, .btn-default.active:hover {
      color:white;
     }
    .mrow {
      display:none;
    }
    .arow {
      display:none;
    }
    .btn.active, .btn:active {
      -webkit-box-shadow:none;
      box-shadow:none;
    }
    .bs-example-modal-sm .btn {
    }
    .modal-body.visible-xs .btn {
    }
    .modal-sm .modal-body .btn {
      height:50px;
      border-radius:0px;
      border-bottom:1px solid #4e4e4e;
      color:white;
    }
    h4 {
      word-wrap:break-word;
    }
    .modal-sm h4 {
      padding-right:15px;
      padding-left:15px;
    }
    .modal-sm .modal-body .btn:last-child {
      border:none;
      border-bottom-left-radius:4px;
      border-bottom-right-radius:4px;
    }
    .modal-sm .modal-body {
      padding:0px;
      padding-top:15px;
    }
    .dot {
     position: absolute;
     margin-top: 8px;
     left: 10px;
    }
    .label {
      font-weight:200;
    }
    .label-primary {
      background-color:#333;
    }
    a.form-control {
      height:inherit;
    }
    .modal-header {
      border:none;
    }
    .modal-content{
      border:none;
      box-shadow:none;
    }
    .lead {
      margin-bottom:30px;
    }
    .movies, .books, .articles {
      padding-bottom:30px;
    }
    #menu-toggle {
    transition: color 1s ease;
    background-color: transparent;
    border: none;
    position: absolute;
    top: 20px;
    left: 20px;
    color: #333;
    font-size: 30;
    }
    .btn {
      text-transform:uppercase;
      letter-spacing:2px;
    }
    .socialbtns li {
          list-style: none outside none;
          display: inline-block;
    }
    .socialbtns .fa {
      width: 35px;
      height: 35px;
      margin-left:5px;
      margin-right:5px;
      background-color: #FFF;
      padding-top: 11px;
      border-radius: 22px;
      -moz-border-radius: 22px;
      -webkit-border-radius: 22px;
      -o-border-radius: 22px;
    }
    #menu .socialbtns .fa {
      color:white;
      background-color:rgba(80,110,148,1);
    }
    .fxd .fa {
      border: 1px solid #ddd;
      color:#ddd;
    }
    .fxd .fa:hover {
      color: white !important;
      background-color: black;
      border: 1px solid black;
    }
    .fxd .fa-vk {
      padding-left:6px;
    }
    .fxd .fa-facebook {
      padding-left:11px;
    }
    .fxd .fa-twitter {
      padding-left:9px;
    }
    .fxd .fa-google-plus {
      padding-left:9px;
    }
    input.form-control {
      border-color:black;
    }
    .read .col-xs-12 {
      padding-left:25px;
    }
    .input-w {
      padding-left:15px;
      padding-right:15px;
    }
    .input-w label {
    position:absolute;
    font-family:arial;
    text-transform:uppercase;
    display: inline-block;
    vertical-align: middle;    
    }
    .input-w input {
      background-color:transparent;
    display: inline-block;
    vertical-align: middle;
    border:none;
    width:100%;
    }
    .modal-body .btn-group{

    }
    #addbook a, input {
      height:60px;
    }
    #addbook .btn{
    border:none;
    }
  body
    .modal.fade.bs-example-modal-sm(id='articlemodal' tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel")
      .modal-dialog.modal-sm
        .modal-content
          .modal-header
            button(type="button" class="close" data-dismiss="modal" aria-label="Close")
              span(aria-hidden="true") ×
          .modal-body
            h4.articlemodaltitle(style='text-align:center;')
            h4.articlemodallink(style='color:gray;text-align:center;font-size:15px;' class='lead')
            a(class='btn btn-primary  form-control article_view' style='margin-top:5px;') View 
            button(class='btn btn-iosdark  form-control article_read') Mark as read
            button(class='btn btn-iosdark  form-control article_good') Mark as good
            button(class='btn btn-iosdark  form-control article_unmark_good') Unmark as good
            button(class='btn btn-iosdark form-control article_remove') Remove
    .modal.fade.bs-example-modal-sm(id='bookmodal' tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel")
      .modal-dialog.modal-sm
        .modal-content
          .modal-header
            button(type="button" class="close" data-dismiss="modal" aria-label="Close")
              span(aria-hidden="true") ×
          .modal-body
            h4.bookmodaltitle(style='text-align:center;')
            h4.bookmodalauthor(style='color:gray;text-align:center;font-size:15px;' class='lead')
            button(class='btn btn-iosdark  form-control book_read' style='margin-top:5px;') Mark as read
            button(class='btn btn-iosdark  form-control book_good') Mark as good
            button(class='btn btn-iosdark  form-control book_unmark_good') Unmark as good
            button(class='btn btn-iosdark form-control book_people') Find people
            button(class='btn btn-iosdark form-control book_remove') Remove
    .modal.fade.bs-example-modal-sm(id='moviemodal' tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel")
      .modal-dialog.modal-sm
        .modal-content
          .modal-header
            button(type="button" class="close" data-dismiss="modal" aria-label="Close")
              span(aria-hidden="true") ×
          .modal-body.visible-md.visible-lg
            h4.moviemodaltitle(style='text-align:center;')
            h4.moviemodalyear(style='color:gray;text-align:center;font-size:15px;' class='lead')
            button(class='btn btn-iosdark  form-control movie_seen' style='margin-top:5px;') Mark as seen
            button(class='btn btn-iosdark  form-control movie_good') Mark as good
            button(class='btn btn-iosdark  form-control movie_unmark_good') Unmark as good
            button(class='btn btn-iosdark form-control movie_people') Find people
            button(class='btn btn-iosdark form-control movie_remove') Remove
    .modal.fade.add_mod(id="addmovie" tabindex="-1" role="dialog" aria-labelledby="myModalLabel")
      .modal-dialog(role="document")
        .modal-content
          .modal-header
            button(type="button" class="close" data-dismiss="modal" aria-label="Close")
              span(aria-hidden="true") ×
            h4(class="modal-title" style='color:#ddd;') Adding a movie
          .modal-body
            form()
              .form-group
                label(for="mtitle") Titile
                input(type="text" maxlength="50" class="form-control" id="mtitle" autocomplete='off' placeholder="The Matrix")
                .row.autocomp#autocompmovies
                  .col-xs-12#srm
              .form-group
                label(for="year") Year
                input(type="text" class="form-control" id="year" autocomplete='off' maxlength="4"  placeholder="1999")
            .form-group
              label(for='new_old') Statistics
              .btn-group#new_old(style='margin-bottom:50px;display:block;')
                button(class='btn btn-iosdark active' id='newmovie' type='button') New
                button(class=' btn btn-iosdark' id='oldmovie'  type='button' )  I've seen it             
          .modal-footer(style='text-align:center;')
            button(class='btn btn-modal'  id='submitmovie') Submit
    .modal.fade.add_mod(id="addarticle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel")
      .modal-dialog(role="document")
        .modal-content
          .modal-header
            button(type="button" class="close" data-dismiss="modal" aria-label="Close")
              span(aria-hidden="true") ×
            h4(class="modal-title" style='color:#ddd;') Adding an article
          .modal-body
            form
              .form-group
                label(for="pagetitle") Titile
                input(type="text" class="form-control" maxlength="50" id="article_title" autocomplete='off' placeholder="Neuroscience")
              .form-group
                label(for="pagelink") Link
                input(type="text" class="form-control" maxlength="150" id="article_link" autocomplete='off' placeholder="https://en.wikipedia.org/wiki/Neuroscience")
            .form-group
              label(for='new_old') Statistics
              .btn-group#new_old(style='margin-bottom:50px;display:block;')
                button(class='btn btn-iosdark active' id='newarticle' type='button') New
                button(class=' btn btn-iosdark' id='oldarticle'  type='button' )  I've read it             
          .modal-footer(style='text-align:center;')
            button(class='btn btn-modal'  id='submitarticle') Submit
    .modal.fade.add_mod(id="addbook" tabindex="-1" role="dialog" aria-labelledby="myModalLabel")
      .modal-dialog(role="document")
        .modal-content
          .modal-header
            button(type="button" class="close" data-dismiss="modal" aria-label="Close")
              span(aria-hidden="true") ×
            h4(class="modal-title"  style='color:#ddd;') Adding a book
          .modal-body(style='padding:0px;padding-top:15px;')
            .input-w(style='background-color:#eee;')
              label(for="#your-input" style='top:45px;') Title
              input(type="text" id="your-input")
            .input-w(style='background-color:#eee;')
              label(for="#your-input2" style='top:90px;') Author
              input(type="text" id="your-input2")
            .btn-group.btn-group-justified#authors(style='background-color:#777;')
              a(class='btn ' id='addauthor'  style='font-size:10px;color:white;border-radius:0px;width:50%;') 
                | Additional author
                span(style='color:white;margin-left:10px;' class='glyphicon glyphicon-plus')
              a(class=' btn  disabled' id='removeauthor'   style='font-size:10px;color:white;border-radius:0px;width:50%;' ) 
                | Remove 
                span(style='color:white;margin-left:10px;' class='glyphicon glyphicon-minus')
            select(class="cs-select cs-skin-border")
              //option(value="" disabled selected) Preferred contact method
              option(value="email" selected) New
              option(value="twitter") I've read it
            select(class="cs-select cs-skin-border")
              //option(value="" disabled selected) Preferred contact method
              option(value="email" selected) Nonfiction
              option(value="twitter") Fiction
            //
              .btn-group.btn-group-justified#new_old(style='background-color:#555;')
                a(class='btn  active' id='newbook'  style='border-radius:0px;width:50%;') New
                a(class=' btn ' id='oldbook'   style='border-radius:0px;width:50%;')  I've read it
              .btn-group.btn-group-justified(style='background-color:#333;')
                a(class='btn  active' id='nonfiction'  style='border-radius:0px;width:50%;') Nonfiction
                a(class=' btn ' id='fiction'  style='border-radius:0px;width:50%;') Fiction 
          //
            .modal-body
              form(id='authoradd_here')
                .form-group
                  label(for="btitle") Titile
                  input(type="text" class="form-control" id="btitle" maxlength="100" autocomplete='off' data-provide="typeahead" placeholder="War and Peace")
                  .row.autocomp#autocompbooks
                    .col-xs-12#srb
                .form-group
                  label(for="title") Author
                  input(type="text" class=" authorinput form-control" maxlength="30" id="author0_name" autocomplete='off' data-provide="typeahead" placeholder="Tolstoy L.")
              .form-group
                label(for='authors') Additional authors
                .btn-group#authors(style='display:block;')
                  button(class='btn btn-iosdark' id='addauthor' type='button') Add
                  button(class=' btn btn-iosdark disabled' id='removeauthor'  type='button' )  Remove
              .form-group(style='margin-top:49px;')
                label(for='new_old') Statistics
                .btn-group#new_old(style='margin-bottom:50px;display:block;')
                  button(class='btn btn-iosdark active' id='newbook' type='button') New
                  button(class=' btn btn-iosdark' id='oldbook'  type='button' )  I've read it
                .btn-group(style='margin-bottom:100px;display:block;')
                  button(class='btn btn-iosdark active' id='nonfiction' type='button') Nonfiction
                  button(class=' btn btn-iosdark' id='fiction' type='button' ) Fiction  
          .modal-footer(style='text-align:center;background-color:#222;border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:none;')
            button(class='btn'  id='submitbook' style='background-color:#ff9900;') Submit
    nav#menu.menu 
      section.menu-section(style='text-align:center;')
        h3
          span(class='label' style='font-family:times,serif;border:1px solid rgba(255,255,255,0.2);color:rgba(255,255,255,0.3);font-style:italic') alpha
      section.menu-section
        ul.menu-section-list    
          li.active
            a(href="/" id='lists') My lists
          li
            a(href="/people" id='pbutton') People
          li 
            a(href='/messages' id='mbutton') Messages
          li
            a(href="/settings" id='settings') Settings
          li
            a(href="/logout" id='logout') Logout
      section.menu-section.visible-xs(style='text-align:center;')
        ul.socialbtns(style='display:inline;margin-top:50px;padding-left:0px;')
          li
            a(href="#" class="social_share fa fa-lg fa-vk" data-type='vk')
          li
            a(href="#" class="social_share fa fa-lg fa-facebook" data-type='fb')
          li
            a(href="#" class="social_share fa fa-lg fa-twitter" data-type='tw')
          li
            a(href="#" class="social_share fa fa-lg fa-google-plus" data-type='gg')          
    .container(id='wait' style='background-color:rgba(0, 0, 0, 0.63);position:fixed;width:100%;height:100%;z-index:9999;display:none;')
      .row(id='spin') 
        .col-xs-12(style='text-align:center;')
          .loader
    .container-fluid#panel
      .socialbtns.fxd.hidden-xs(style='position:absolute;top:20px;right:20px;z-index:1000;')
        a(href="#" class="social_share fa fa-lg fa-vk" data-type='vk')
        a(href="#" class="social_share fa fa-lg fa-facebook" data-type='fb')
        a(href="#" class="social_share fa fa-lg fa-twitter" data-type='tw')
        a(href="#" class="social_share fa fa-lg fa-google-plus" data-type='gg')
      button(type='button' ,id='menu-toggle')
        span.glyphicon.glyphicon-menu-hamburger
      .row.visible-lg.visible-md.visible-sm(style='text-align:center;')
        .col-xs-12.col-lg-10.col-lg-offfset-1.col-md-10.col-md-offset-1
          .row
            #avatarbig.col-xs-12(style='text-align:center;')         
              h2(style='margin-top:30px;' class='usernick')  ...
          .row(style='margin-bottom:20px;margin-top:60px;')
            .col-xs-12
              button.btn.btn-iosdark.openadd(type='button' style='margin-right:20px;box-shadow: 1px 5px 10px 1px #DADADA;') Add item
              .btn-group(style='margin-right:20px;box-shadow: 1px 5px 10px 1px #DADADA;border-radius:4px;')
                button.btn.btn-iosdark.showbooks.active(type='button')  Books
                  span(class='badge booknum' style='margin-left:10px;') 0
                button.btn.btn-iosdark.showmovies(type='button')  Movies
                  span(class='badge movienum' style='margin-left:10px;') 0
                button.btn.btn-iosdark.showarticles(type='button') Links
                  span(class='badge articlenum' style='margin-left:10px;') 0
      .row
        #booklist.thun.col-md-12
          .row.visible-xs
            #avatarsmall.col-xs-12(style='min-width:100px;padding-bottom:10px;padding-top:20px;text-align:center;')                                
              //h4.numbers                 
              button.btn.btn-lg.btn-iosdark.openadd(type='button' style='margin-bottom:20px;margin-top:30px;box-shadow: 1px 5px 10px 1px #DADADA;') Add item
              .row 
                .col-xs-12
                  .btn-group.btn-group-sm(style='margin-top:20px;margin-bottom:20px;box-shadow: 1px 5px 10px 1px #DADADA;border-radius:4px;')
                    .btn.btn-iosdark.active.showbooks(type='button') B
                      span(class='badge booknum' style='margin-left:10px;') 0
                    .btn.btn-iosdark.showmovies(type='button') M
                      span(class='badge movienum' style='margin-left:10px;') 0
                    .btn.btn-iosdark.showarticles(type='button' ) L
                      span(class='badge articlenum' style='margin-left:10px;') 0
          #list.row
            .col-xs-12.col-lg-10.col-lg-offfset-1.col-md-10.col-md-offset-1              
              .row.mrow
                .col-xs-12.visible-lg.visible-md.visible-sm.movies#bigscreens
                  .nomovies.row(style='text-align:center;')  
                     .col-xs-12
                       h2.noitems(style='color:#ccc;margin-bottom:20px;') No items 
              .row.brow
                .col-xs-12.visible-lg.visible-md.visible-sm.books#bigscreens
                  .nobooks.row(style='text-align:center;')  
                     .col-xs-12
                       h2.noitems(style='color:#ccc;margin-bottom:20px;') No items
              .row.arow
                .col-xs-12.visible-lg.visible-md.visible-sm.articles#bigscreens
                  .noarticles.row(style='text-align:center;')  
                     .col-xs-12
                       h2.noitems(style='color:#ccc;margin-bottom:20px;') No items  
              .row.brow
                #smallscreens.visible-xs.col-xs-12.books(style='border-top:1px solid #eee;')         
                  .nobooks.row(style='text-align:center;')  
                     .col-xs-12
                       h2.noitems(style='color:#ccc;margin-bottom:20px;') No items 
              .row.mrow
                #smallscreens.visible-xs.col-xs-12.movies(style='border-top:1px solid #eee;')       
                  .nomovies.row(style='text-align:center;')  
                     .col-xs-12
                       h2.noitems(style='color:#ccc;margin-bottom:20px;') No items  
              .row.arow
                #smallscreens.visible-xs.col-xs-12.articles(style='border-top:1px solid #eee;')       
                  .noarticles.row(style='text-align:center;')  
                     .col-xs-12
                       h2.noitems(style='color:#ccc;margin-bottom:20px;') No items  
    // jQuery (necessary for Bootstrap's JavaScript plugins)
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js')
    // Include all compiled plugins (below), or include individual files as needed
    script(src='js/bootstrap.min.js')     
    script(async src='/js/counter.js') 
    script.
      function() {
                [].slice.call( document.querySelectorAll( 'select.cs-select' ) ).forEach( function(el) {  
                  new SelectFx(el);
                } );
              })();
      //restrict - all checks are both client/server implemented /
      $('.authorinput').bind('keypress', function (event) {
          var regex = /^[.\/\w]/i;
          var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
          if (!regex.test(key)) {
             event.preventDefault();
             return false;
          }
      });
      //restrict//
      var slideout = new Slideout({
        'panel': document.getElementById('panel'),
        'menu': document.getElementById('menu'),
        'padding': 256,
        'tolerance': 70
      });
      document.querySelector('#menu-toggle').addEventListener('click', function() {
        slideout.toggle();
      });
      $(document).on('click', '.social_share', function(){
          Share.go(this);
      });
      var user = !{JSON.stringify(done)};
      user= JSON.parse(user);
      if(user.lang==='ru'){
        $('#lists').text('Мои списки')
        $('#mbutton').text('Сообщения');
        $('#pbutton').text('Чужие списки');
        $('#settings').text('Настройки');
        $('#logout').text('Выход');
        $('.showbooks').text('Книги');
        $('.showmovies').text('Фильмы');
        $('.showarticles').text('Ссылки');
        $('.noitems').text('Список пуст');
        $('.openadd').text('Добавить');
      }
      else {
        $('#lists').text('My lists')
        $('#mbutton').text('Messages');
        $('#pbutton').text('People');
        $('#settings').text('Settings');
        $('#logout').text('Logout');
        $('.showbooks').text('Books');
        $('.showmovies').text('Movies');
        $('.showarticles').text('Links');
        $('.noitems').text('No items');
        $('.openadd').text('Add item');
      }
      $('.usernick').text(user.nick);
      $('.booknum').text(user.readbooks);
      $('.movienum').text(user.seenmovies);
      $('.articlenum').text(user.readarticles);
      var tmstmp = Date.now();
      var avatar = #{avatar};
      if(avatar) {
        $('#avatarbig').prepend("<img id='userimg' class='img-circle ' style='margin:auto !important;box-shadow: 1px 5px 10px 1px #DADADA;' src='/userpics/"+user._id+".png'></img>");
        $('#avatarsmall').prepend("<img id='userimg' class='img-circle' style='margin:auto!important;height:200px;width:200px;box-shadow: 1px 5px 10px 1px #DADADA;' src='/userpics/"+user._id+".png'></img><h3 style='margin-top:20px;font-weight:500;'>"+user.nick+"</h3>");
      }
      else {
        $('#avatarbig').prepend("<div id=emptyavatar class='img-circle' style='margin:auto !important;'></div>");
        $('#avatarsmall').prepend("<div id=emptyavatar style='margin:auto !important;' class='img-circle'></div><h3 style='margin-top:20px;font-weight:500;'>"+user.nick+"</h3>");
      }
      //$('.numbers').append(user.readbooks+"<span style='color:#ddd;'> / </span>"+user.seenmovies);
      //$('#bookstitle').empty().append("<span style='color:#b76e00;'>"+user.readbooks+"</span")
      String.prototype.capitalizeFirstLetter = function() {
          return this.charAt(0).toUpperCase() + this.slice(1);
      }
      $('.showbooks').click(function(){
        if($('.brow').css('display')==='none'){
          console.log('show brow');
          $('.showarticles').removeClass('active');
          $('.showmovies').removeClass('active');
          $('.showbooks').addClass('active');
          $('.brow').css('display','block')
          $('.mrow').css('display','none');
          $('.arow').css('display','none');
        }
        });
      $('.showmovies').click(function(){
        if($('.mrow').css('display')==='none'){
          console.log('show mrow');
          $('.showarticles').removeClass('active');
          $('.showbooks').removeClass('active');
          $('.showmovies').addClass('active');
          $('.mrow').css('display','block')
          $('.brow').css('display','none');
          $('.arow').css('display','none');
        }
        });
      $('.showarticles').click(function(){
        if($('.arow').css('display')==='none'){
          console.log('show arow');
          $('.showmovies').removeClass('active');
          $('.showbooks').removeClass('active');
          $('.showarticles').addClass('active');
          $('.brow').css('display','none')
          $('.mrow').css('display','none');
          $('.arow').css('display','block');
        }
        });
      setTimeout(function(){
        if($('#btitle').val() && $('#author0_name').val() && $('#author0_surname').val()){
          alert($('#btitle').val() && $('#author0_name').val() && $('#author0_surname').val());
        }
        },2000);
       var books;
       var movies;
       var articles;
       var modal_data_store=[];
       var movie_modal_data_store=[];
       var article_modal_data_store=[];
       $.ajax({
              method: "POST",
              url: "/getitems",
              data: 0
            })
              .done(function( msg ) {
                if(!msg.trouble) {
                   books=msg.doc.bookstore;
                  if(!books || !books.length) {
                   console.log('no books');
                   }
                   else {
                    populatebooks(books);
                   }
                   movies=msg.doc.moviestore;
                  if(!movies || !movies.length) {
                   console.log('no movies');
                   }
                   else {
                    populatemovies(movies);
                   }
                   articles=msg.doc.articlestore;
                  if(!articles || !articles.length) {
                   console.log('no articles');
                   }
                   else {
                    populatearticles(articles);
                   }
                }
              });
      // Discontinued because we supply boooks and movies through user object. 
      // When we will do optimization and user's books and movies might move into separate db
      // this might will be brought back
      //$.ajax({
      //   method: "POST",
      //   url: "/getbooks/#{user}",
      //   data: 0
      // })
      //   .done(function( msg ) {
      //     console.log('msg is: '+msg);
      //     books = msg;
      //     console.log(JSON.stringify(books));
      //     count = books.length -1;
      //     if(!books) {
      //      //alert('server maintenence \n try again later');
      //     // $('#myModal').modal('show');
      //     console.log('no items');
      //     }
      //     else {
      //      getbooks(books,count);
      //     }
      //     });
      function modal_input_sizing () {
        console.log('modal_input_sizing running');
        if($('#avatarsmall').is(':visible') ){
          console.log('case 1');
          $('.form-group').addClass('form-group-lg');
          $('.add_mod .btn-group').addClass('btn-group-lg');
          $('#nonfiction').text('Nonfict.');
        }
        else {
          console.log('case 2');
          $('.form-group').removeClass('form-group-lg');
          $('.add_mod  .btn-group').removeClass('btn-group-lg');
          $('#nonfiction').text('Nonfiction');
        }
        return 0
      }
      function populatebooks(books) {
        if ($(".nobooks")[0])
            { console.log('HAS LENGTH');
              $('.books').empty();}
            else {
              console.log('HASNT GOT LENGTH');
            }
        books.forEach(function(element,index){
          var authors_insert=' ';
            if(element.authors&&element.authors[0]){
              element.authors.forEach(function(element2){
              authors_insert+='  '+element2;
               });
            }
           var insert;
            switch(true){
              case(element.goodbook&&!element.newbook):
              console.log('1st case');
              insert = "<div class='row book read book"+element._id+"'><div class='col-xs-12 bookpadding hovershade' onclick='redactbookmodal("+index+");'><h3 class='btitle"+element._id+"' style='margin-left:25px;'>"+element.title.capitalizeFirstLetter()+"<span class='good"+element._id+" label label-primary pull-right'>GOOD</span></h3><h5 class='hidden-lg hidden-md hidden-sm sm_hd"+element._id+"' style='color:#ddd;margin-left:25px;'>"+authors_insert+"</h5></div></div>";
              var thisbook={};
              thisbook.author = authors_insert;
              thisbook.title = element.title.capitalizeFirstLetter();
              modal_data_store.push(thisbook);
              break
              case(element.newbook&&!element.goodbook):
              console.log('2st case');
              insert = "<div class='row book new book"+element._id+"' ><div class='col-xs-12 bookpadding hovershade' onclick='redactbookmodal("+index+");'><h3 class='btitle"+element._id+"' style='margin-left:15px;'> "+element.title.capitalizeFirstLetter()+"<small class='hidden-xs' style='margin-left:15px;color:#ddd;' >"+authors_insert+"</small></h3><h5 class='hidden-lg hidden-md hidden-sm' style='color:#ddd;margin-left:25px;'>"+authors_insert+"</h5></div></div>";
              var thisbook={};
              thisbook.author = authors_insert;
              thisbook.title = element.title.capitalizeFirstLetter();
              modal_data_store.push(thisbook);
              console.log(modal_data_store);
              break
              case(!element.newbook&&!element.goodbook):
              console.log('3st case');
              insert = "<div class='row book read book"+element._id+"'><div class='col-xs-12 bookpadding hovershade' onclick='redactbookmodal("+index+");'><h3 class='btitle"+element._id+"' style='margin-left:25px;'> "+element.title.capitalizeFirstLetter()+"<small class='hidden-xs' style='margin-left:15px;color:#ddd;''>"+authors_insert+"</small></h3><h5 class='hidden-lg hidden-md hidden-sm' style='color:#ddd;margin-left:25px;'>"+authors_insert+"</h5></div></div>";
              var thisbook={};
              thisbook.author = authors_insert;
              thisbook.title = element.title.capitalizeFirstLetter();
              modal_data_store.push(thisbook);
              break
            }         
           $('.books').append(insert);
          });
      }
      function populatemovies(movies) {
        if ($(".nomovies")[0])
            { console.log('HAS LENGTH');
              $('.movies').empty();}
            else {
              console.log('HASNT GOT LENGTH');
            }
        movies.forEach(function(element,index){
          var insert;   
            switch(true){
              case(element.goodmovie&&!element.newmovie):
              console.log('1st case');
              insert = "<div class='row book read movie"+element._id+"'><div class='col-xs-12 bookpadding hovershade' onclick='redactmoviemodal("+index+");'><h3 class='mtitle"+element._id+"' style='margin-left:25px;'> "+element.title.capitalizeFirstLetter()+"<small class='hidden-xs' style='margin-left:15px;color:#ddd;'>"+element.year+"</small><span class='good"+element._id+" label label-primary pull-right'>GOOD</span></h3><h5  class='hidden-lg hidden-md hidden-sm sm_hd"+element._id+"' style='color:#ddd;margin-left:25px;'>"+element.year+"</h5></div></div>";
              var thismovie={};
              thismovie.year = element.year;
              thismovie.title = element.title.capitalizeFirstLetter();
              movie_modal_data_store.unshift(thismovie);
              break
              case(element.newmovie&&!element.goodmovie):
              console.log('2st case');
              insert = "<div class='row book new movie"+element._id+"'><div class='col-xs-12 bookpadding hovershade' onclick='redactmoviemodal("+index+");'><h3 class='mtitle"+element._id+"' style='margin-left:25px;'> "+element.title.capitalizeFirstLetter()+"<small class='hidden-xs' style='margin-left:15px;color:#ddd;' >"+element.year+"</small></h3><h5 class='hidden-lg hidden-md hidden-sm sm_hd"+element._id+"' style='color:#ddd;margin-left:25px;'>"+element.year+"</h5></div></div>";
              var thismovie={};
              thismovie.year = element.year;
              thismovie.title = element.title.capitalizeFirstLetter();
              movie_modal_data_store.unshift(thismovie);
              console.log(modal_data_store);
              break
              case(!element.newmovie&&!element.goodmovie):
              console.log('3st case');
              insert = "<div class='row book read movie"+element._id+"'><div class='col-xs-12 bookpadding hovershade' onclick='redactmoviemodal("+index+");'><h3 class='mtitle"+element._id+"' style='margin-left:25px;'> "+element.title.capitalizeFirstLetter()+"<small class='hidden-xs' style='margin-left:15px;color:#ddd;''>"+element.year+"</small></h3><h5 class='hidden-lg hidden-md hidden-sm sm_hd"+element._id+"' style='color:#ddd;margin-left:25px;'>"+element.year+"</h5></div></div>";
              var thismovie={};
              thismovie.year = element.year;
              thismovie.title = element.title.capitalizeFirstLetter();
              movie_modal_data_store.unshift(thismovie);
              break
            }         
           $('.movies').append(insert);
          });
      }
      //---------------------------------//
      function populatearticles(articles) {
        
        for(var xx=articles.length-1;xx>=0;xx--){
            if ($(".noarticles")[0])
            { $('.articles').empty();}
            //var checktitle = article_modal_data_store[i].link.substring(0, 4);
            switch(true){
              case(articles[xx].goodarticle&&!articles[xx].newarticle):
              console.log('1st case');
              insert = "<div class='row book read article"+articles[xx]._id+"'><div class='col-xs-12 bookpadding hovershade' onclick='redactarticlemodal("+xx+");'><h3 class='atitle"+articles[xx]._id+"' style='margin-left:25px;'>"+articles[xx].title.capitalizeFirstLetter()+"<small class='hidden-xs' style='margin-left:15px;color:#ddd;''>"+articles[xx].link.substring(0,10)+"</small><span class='good"+articles[xx]._id+" label label-primary pull-right'>GOOD</span></h3><h5 class='hidden-lg hidden-md hidden-sm sm_hd"+articles[xx]._id+"' style='color:#ddd;margin-left:25px;'>"+articles[xx].link.substring(0,30)+"..</h5></div></div>";
              var thisarticle={};
              thisarticle.link = articles[xx].link;
              thisarticle.title = articles[xx].title.capitalizeFirstLetter();
              article_modal_data_store.unshift(thisarticle);
              break
              case(articles[xx].newarticle&&!articles[xx].goodarticle):
              console.log('2st case');
              insert = "<div class='row book new article"+articles[xx]._id+"' ><div class='col-xs-12 bookpadding hovershade' onclick='redactarticlemodal("+xx+");'><h3 class='atitle"+articles[xx]._id+"' style='margin-left:15px;'> "+articles[xx].title.capitalizeFirstLetter()+"<small class='hidden-xs' style='margin-left:15px;color:#ddd;''>"+articles[xx].link.substring(0,30)+"...</small></h3><h5 class='hidden-lg hidden-md hidden-sm sm_hd"+articles[xx]._id+"' style='color:#ddd;margin-left:25px;'>"+articles[xx].link.substring(0,30)+"..</h5></div></div>";
              var thisarticle={};
              thisarticle.link = articles[xx].link;
              thisarticle.title = articles[xx].title.capitalizeFirstLetter();
              article_modal_data_store.unshift(thisarticle);
              break
              case(!articles[xx].newarticle&&!articles[xx].goodarticle):
              console.log('3st case');
              insert = "<div class='row book read article"+articles[xx]._id+"'><div class='col-xs-12 bookpadding hovershade' onclick='redactarticlemodal("+xx+");'><h3 class='atitle"+articles[xx]._id+"' style='margin-left:25px;'> "+articles[xx].title.capitalizeFirstLetter()+"<small class='hidden-xs' style='margin-left:15px;color:#ddd;''>"+articles[xx].link.substring(0,30)+"...</small></h3><h5 class='hidden-lg hidden-md hidden-sm sm_hd"+articles[xx]._id+"' style='color:#ddd;margin-left:25px;'>"+articles[xx].link.substring(0,30)+"..</h5></div></div>";
              var thisarticle={};
              thisarticle.link = articles[xx].link;
              thisarticle.title = articles[xx].title.capitalizeFirstLetter();
              article_modal_data_store.unshift(thisarticle);
              break
            }         
           $('.articles').append(insert);
         }// for
      }
      //----------------------------//
      var authorcount=0;
      $('#addauthor').click(addauthor);
      function addauthor() {
        console.log('addauthor running');
        authorcount++;
        if($('#removeauthor').hasClass('disabled')){
          $('#removeauthor').removeClass('disabled');
        }
        //var insert =   "<div class='well' id='author"+authorcount+"' style='display:none;'><div class='form-group'><label for='author"+authorcount+"_name' >Author name</label><input type='text' class='form-control' id='author"+authorcount+"_name' placeholder='Leo'></input></div><div class='form-group'><label for='author"+authorcount+"_surname'>Author surname</label><input type='text' class='form-control' id='author"+authorcount+"_surname' placeholder='Tolstoy'></input></div></div>";
        var insert =   "<div id='author"+authorcount+"' style='display:none;' class='form-group'><label for='author"+authorcount+"_name' >Author</label><input maxlength='30' type='text' class=' authorinput form-control' id='author"+authorcount+"_name' placeholder='Tolstoy L.'></input></div>";
        console.log(insert);
        $('#authoradd_here').append(insert);
        eval("$('#author"+authorcount+"').slideToggle();");
      }
      $('#removeauthor').click(function(){
        if(authorcount>0)
        { eval("$('#author"+authorcount+"').slideToggle();");
          setTimeout(function(){eval("$('#author"+authorcount+"').remove();authorcount--;if(authorcount===0){$('#removeauthor').addClass('disabled');}");},1100);
              }
        });
      $('.openadd').click(function(){
        modal_input_sizing();
        if($('.brow').css('display')==='block')
          {$('#addbook').modal('show');}
        else if($('.mrow').css('display')==='block'){
            $('#addmovie').modal('show');
           }
        else {
        $('#addarticle').modal('show');
        }
        });
       $.ajax({
              method: "POST",
              url: "/ntfc_m",
              data: 0
            }).done(function( msg ) {
                if(msg.newmsg){
                 $('#mbutton').append('<span style="vertical-align:baseline;color:#37AFD6;font-size:20px;margin-left:10px;">•</span>');
                  $('#menu-toggle').css('color','#37AFD6');
                }
               });
        $.ajax({
              method: "POST",
              url: "/ntfc_p",
              data: 0
            }).done(function( msg ) {
                if(msg.newp){
                 $('#pbutton').append('<span style="vertical-align:baseline;color:#37AFD6;font-size:20px;margin-left:10px;">•</span>');
                  $('#menu-toggle').css('color','#37AFD6');
                }
               });
      function redactbookmodal (i) {
        if(books[i].goodbook){
          $('.book_good').css('display','none');
          var insert = 'unmarkbookgood('+i+')';
          $('.book_unmark_good').attr('onclick',insert);
          $('.book_unmark_good').css('display','block');
        }
        else {
          $('.book_unmark_good').css('display','none');
          var insert = 'markbookgood('+i+')';
          $('.book_good').attr('onclick',insert);
          $('.book_good').css('display','block');
        }
        if(!books[i].newbook){
         $('.book_read').css('display','none');
        }
        else {
          var insert = 'markread('+i+')';
          $('.book_read').attr('onclick',insert);
          $('.book_read').css('display','block');
          $('.book_good').css('display','none');
        }
        insert = 'removebook('+i+')';
        $('.book_remove').attr('onclick',insert);
        insert = 'window.location="/people/b/'+books[i]._id+'"';
        $('.book_people').attr('onclick',insert);
        $('.bookmodaltitle').text(modal_data_store[i].title);
        $('.bookmodalauthor').text(modal_data_store[i].author);
        $('#bookmodal').modal('show');
      }
      //
      function redactarticlemodal (i) {
        var link = article_modal_data_store[i].link;
        var checktitle = article_modal_data_store[i].link.substring(0, 4);
        if(checktitle!='http'){
         var link = "http://"+link;}
         $('.article_view').attr('href',link);
        if(articles[i].goodarticle){
          $('.article_good').css('display','none');
          var insert = 'unmarkarticlegood('+i+')';
          $('.article_unmark_good').attr('onclick',insert);
          $('.article_unmark_good').css('display','block');
        }
        else {
          $('.article_unmark_good').css('display','none');
          var insert = 'markarticlegood('+i+')';
          $('.article_good').attr('onclick',insert);
          $('.article_good').css('display','block');
        }
        if(!articles[i].newarticle){
         $('.article_read').css('display','none');
        }
        else {
          var insert = 'markarticleread('+i+')';
          $('.article_read').attr('onclick',insert);
          $('.article_read').css('display','block');
          $('.article_good').css('display','none');
        }
        insert = 'removearticle('+i+')';
        $('.article_remove').attr('onclick',insert);
        $('.articlemodaltitle').text(article_modal_data_store[i].link);
        $('.articlemodallink').text(article_modal_data_store[i].title);
        $('#articlemodal').modal('show');
      }
      //
      function redactmoviemodal (i) {
        if(movies[i].goodmovie){
          $('.movie_good').css('display','none');
          var insert = 'unmarkmoviegood('+i+')';
          $('.movie_unmark_good').attr('onclick',insert);
          $('.movie_unmark_good').css('display','block');
        }
        else {
          $('.movie_unmark_good').css('display','none');
          var insert = 'markmoviegood('+i+')';
          $('.movie_good').attr('onclick',insert);
          $('.movie_good').css('display','block');
        }
        if(!movies[i].newmovie){
         $('.movie_seen').css('display','none');
        }
        else {
          var insert = 'markseen('+i+')';
          $('.movie_seen').attr('onclick',insert);
          $('.movie_seen').css('display','block');
          $('.movie_good').css('display','none');
        }
        insert = 'removemovie('+i+')';
        $('.movie_remove').attr('onclick',insert);
        insert = 'window.location="/people/m/'+movies[i]._id+'"';
        $('.movie_people').attr('onclick',insert);
        $('.moviemodaltitle').text(movie_modal_data_store[i].title);
        $('.moviemodalyear').text(movie_modal_data_store[i].year);
        $('#moviemodal').modal('show');
      }
      $('#closeadd').click(function(){
        $('#addbook').modal('hide');
        });
      $('#openextra').click(function(){
        $('#extra').slideToggle();
        }); 
      $('#oldbook').click(function(){
        if($('#oldbook').hasClass('active')){
        }
        else{
          $('#oldbook').addClass('active');
          $('#newbook').removeClass('active');
        }
        });
      $('#newbook').click(function(){
        if($('#newbook').hasClass('active')){
        }
        else{
          $('#newbook').addClass('active');
          $('#oldbook').removeClass('active');
        }
        });
      $('#oldmovie').click(function(){
        if($('#oldmovie').hasClass('active')){
        }
        else{
          $('#oldmovie').addClass('active');
          $('#newmovie').removeClass('active');
        }
        });
      $('#newmovie').click(function(){
        if($('#newmovie').hasClass('active')){
        }
        else{
          $('#newmovie').addClass('active');
          $('#oldmovie').removeClass('active');
        }
        });
      $('#oldarticle').click(function(){
        if($('#oldarticle').hasClass('active')){
        }
        else{
          $('#oldarticle').addClass('active');
          $('#newarticle').removeClass('active');
        }
        });
      $('#newarticle').click(function(){
        if($('#newarticle').hasClass('active')){
        }
        else{
          $('#newarticle').addClass('active');
          $('#oldarticle').removeClass('active');
        }
        });
      $('#fiction').click(function(){
        if($('#fiction').hasClass('active')){
        }
        else{
          $('#fiction').addClass('active');
          $('#nonfiction').removeClass('active');
        }
        });
      $('#nonfiction').click(function(){
        if($('#nonfiction').hasClass('active')){
        }
        else{
          $('#nonfiction').addClass('active');
          $('#fiction').removeClass('active');
        }
        });
      var lastentry;
      $('#btitle').focusout(function(){
        if($('#autocompbooks').css('display','block')) {
          $('#autocompbooks').fadeOut(350);
        }
        });
      $('#mtitle').focusout(function(){
        if($('#autocompmovies').css('display','block')) {
          $('#autocompmovies').fadeOut(350);
        }
        });
      $('#btitle').keyup(function(event) {
        if($('#btitle').val() != lastentry && $('#btitle').val().length >3) {       
          //$('div').append('TEST'+$(this).val()+"<br>");
          $.ajax({
            method: "POST",
            url: "/livesearch/btitle",
            data: { txt: $('#btitle').val() }
          }).done(function( msg ) {
              console.log(msg);
              if(msg)
                { $('#srb').empty();
                  for(var btitle =0;btitle<msg.length;btitle++){
                    console.log('vtitle: '+msg[btitle]);
                    //var click = "$('#btitle').val('"+msg[btitle].title.capitalizeFirstLetter()+"');$('#autocomp').fadeOut(350);$('#srb').empty();";
                    $('#srb').append("<div class='row sritem' id='hint"+btitle+"'><div class='col-xs-12'>"+msg[btitle].title.capitalizeFirstLetter()+"<span id='authors"+btitle+"' style='color:#ddd;margin-left:10px;'></span></div></div>");
                    for(var xx=0;xx<msg[btitle].authors.length;xx++){
                      if(xx===0)
                      {eval("$('#authors"+btitle+"').append('"+msg[btitle].authors[xx].capitalizeFirstLetter()+"');");}
                      else {
                        eval("$('#authors"+btitle+"').append(', "+msg[btitle].authors[xx].capitalizeFirstLetter()+"');");
                      }
                      var click="if($('#author"+xx+"_name').length){$('#author"+xx+"_name').val('"+msg[btitle].authors[xx].capitalizeFirstLetter()+"');}else{addauthor();$('#author"+xx+"_name').val('"+msg[btitle].authors[xx].capitalizeFirstLetter()+"');}$('#btitle').val('"+msg[btitle].title.capitalizeFirstLetter()+"');$('#autocompbooks').fadeOut(350);$('#srb').empty();$('#addauthor').addClass('disabled');";
                    }
                    eval("$('#hint"+btitle+"').attr('onclick',click);");
                   }
                  $('#autocompbooks').fadeIn(350);
                  }
                            else {
                              lastentry = $('#btitle').val();
                            }
                });
        }
       lastentry = $('#btitle').val()
      });
      
      $('#mtitle').keyup(function(event) {
        if($('#mtitle').val() != lastentry && $('#mtitle').val().length >3) {       
          //$('div').append('TEST'+$(this).val()+"<br>");
          $.ajax({
            method: "POST",
            url: "/livesearch/mtitle",
            data: { txt: $('#mtitle').val() }
          }).done(function( msg ) {
              console.log(msg);
              if(msg)
                { $('#srm').empty();
                  for(var mtitle =0;mtitle<msg.length;mtitle++){
                    console.log('vtitle: '+msg[mtitle]);
                    $('#srm').append("<div class='row sritem' id='hint"+mtitle+"'><div class='col-xs-12'>"+msg[mtitle].title.capitalizeFirstLetter()+"<span style='color:#ddd;margin-left:10px;'>"+msg[mtitle].year+"</span></div></div>");
                    var click="if($('#year').length){$('#year').val('"+msg[mtitle].year+"');}else{addauthor();$('#year').val('"+msg[mtitle].year+"');}$('#mtitle').val('"+msg[mtitle].title.capitalizeFirstLetter()+"');$('#autocompmovies').fadeOut(350);$('#srm').empty();$('#year').addClass('disabled');";
                    eval("$('#hint"+mtitle+"').attr('onclick',click);");
                   }
                  $('#autocompmovies').fadeIn(350);
                  }
                            else {
                              lastentry = $('#mtitle').val();
                            }
                });
        }
       lastentry = $('#mtitle').val()
      });
      //-----------------------------------//
      //got rid of second argument in both functions (books arr) because there is only one
      function markread(bookid) {
        $.ajax({
              method: "POST",
              url: "/markread/"+books[bookid]._id,
              data: 0
            })
              .done(function( msg ) {
                console.log(msg);
                $('#bookmodal').modal('hide');
                books[bookid].newbook=0;
                var vname = '.book'+books[bookid]._id;
                var vname2 = '.btitle'+books[bookid]._id;
                $(vname2).css('margin-left','25px');
                $(vname).css('border-left','none');
                $(vname).removeClass('new');
                user.readbooks++;
                $('.booknum').text(user.readbooks);
              });
      }
      //-----------------------------------//
      function markbookgood(bookid) {
        $.ajax({
              method: "POST",
              url: "/markbookgood/"+books[bookid]._id,
              data: 0
            })
              .done(function( msg ) {
                $('#bookmodal').modal('hide');
                var insert = "<span class='label label-primary pull-right good"+books[bookid]._id+"'>GOOD</span>";
                var vname = '.btitle'+books[bookid]._id;
                $(vname).append(insert);
                $(vname).css('margin-left','25px');
                books[bookid].goodbook=1;
              });
      }
      //-----------------------------------//
      function unmarkbookgood(bookid) {
        $('#wait').css('display','block');
        $.ajax({
              method: "POST",
              url: "/unmarkbookgood/"+books[bookid]._id,
              data: 0
            })
              .done(function( msg ) {
                $('#bookmodal').modal('hide');
                var vname = '.good'+books[bookid]._id;
                $(vname).remove();
                books[bookid].goodbook=0;
                $('#wait').css('display','none');
              });
      }
      //-----------------------------------//
      function unmarkmoviegood(movieid) {
        $('#wait').css('display','block');
        $.ajax({
              method: "POST",
              url: "/unmarkmoviegood/"+movies[movieid]._id,
              data: 0
            })
              .done(function( msg ) {
                $('#moviemodal').modal('hide');
                var vname = '.good'+movies[movieid]._id;
                $(vname).remove();
                movies[movieid].goodmovie=0;
                $('#wait').css('display','none');
              });
      }
      //-----------------------------------//
      function unmarkarticlegood(articleid) {
        $('#wait').css('display','block');
        $.ajax({
              method: "POST",
              url: "/unmarkarticlegood/"+articles[articleid]._id,
              data: 0
            })
              .done(function( msg ) {
                $('#articlemodal').modal('hide');
                var vname = '.good'+articles[articleid]._id;
                $(vname).remove();
                articles[articleid].goodarticle=0;
                $('#wait').css('display','none');
              });
      }
      //-----------------------------------//
      function removebook(bookid) {
        $.ajax({
              method: "POST",
              url: "/removebook/"+books[bookid]._id,
              data: 0
            })
              .done(function( msg ) {
                $('#bookmodal').modal('hide');
                var vname = '.book'+books[bookid]._id;
                $(vname).empty();
                user.totalbooks--;
                if(books[bookid].newbook){
                  user.newbook--;
                }
                  else{
                    user.readbooks--;
                    $('.booknum').text(user.readbooks);
                  }
                if(!user.totalbooks){
                  $('.books').append("<div class='nobooks row' style='text-align:center;'><div class='col-xs-12'><h2 style='color:#ccc;margin-bottom:20px;'> No items</h2></div></div>");
                }
              });
      }
      //-----------------------------------//
      function markarticleread(articleid) {
        $.ajax({
              method: "POST",
              url: "/markarticleread/"+articles[articleid]._id,
              data: 0
            })
              .done(function( msg ) {
                console.log(msg);
                $('#articlemodal').modal('hide');
                articles[articleid].newarticle=0;
                var vname = '.article'+articles[articleid]._id;
                var vname2 = '.atitle'+articles[articleid]._id;
                $(vname2).css('margin-left','25px');
                $(vname).css('border-left','none');
                $(vname).removeClass('new');
                user.readarticles++;
                $('.articlenum').text(user.readarticles);
              });
      }
      //-----------------------------------//
      function markseen(movieid) {
        $.ajax({
              method: "POST",
              url: "/markseen/"+movies[movieid]._id,
              data: 0
            })
              .done(function( msg ) {
                console.log(msg);
                $('#moviemodal').modal('hide');
                movies[movieid].newmovie=0;
                var vname = '.movie'+movies[movieid]._id;
                var vname2 = '.mtitle'+movies[movieid]._id;
                $(vname2).css('margin-left','25px');
                $(vname).css('border-left','none');
                $(vname).removeClass('new');
                user.seenmovies++;
                $('.movienum').text(user.seenmovies)
              });
      }
      //-----------------------------------//
      function markmoviegood(movieid) {
        $.ajax({
              method: "POST",
              url: "/markmoviegood/"+movies[movieid]._id,
              data: 0
            })
              .done(function( msg ) {
                $('#moviemodal').modal('hide');
                var insert = "<span class='label label-primary pull-right good"+movies[movieid]._id+"'>GOOD</span>";
                var vname = '.mtitle'+movies[movieid]._id;
                $(vname).prepend(insert);
                $(vname).css('margin-left','25px');
                movies[movieid].goodmovie=1;
              });
      }
      //-----------------------------------//
      function markarticlegood(articleid) {
        $.ajax({
              method: "POST",
              url: "/markarticlegood/"+articles[articleid]._id,
              data: 0
            })
              .done(function( msg ) {
                $('#articlemodal').modal('hide');
                var insert = "<span class='label label-primary pull-right good"+articles[articleid]._id+"'>GOOD</span>";
                var vname = '.atitle'+articles[articleid]._id;
                $(vname).prepend(insert);
                $(vname).css('margin-left','25px');
                articles[articleid].goodarticle=1;
              });
      }
      //-----------------------------------//
      function removemovie(movieid) {
        $.ajax({
              method: "POST",
              url: "/removemovie/"+movies[movieid]._id,
              data: 0
            })
              .done(function( msg ) {
                $('#moviemodal').modal('hide');
                var vname = '.movie'+movies[movieid]._id;
                $(vname).empty();
                user.totalmovies--;
                if(movies[movieid].newmovie){
                  user.newmovie--;
                }
                  else{
                    user.readmovies--;
                  }
                if(!user.totalmovies){
                  $('.moviess').append("<div class='nobooks row' style='text-align:center;'><div class='col-xs-12'><h2 style='color:#ccc;margin-bottom:20px;'> No items</h2></div></div>");
                }
              });
      }
      //-----------------------------------//
      $('#submitbook').click(function(){
        if($('#btitle').val() )
        { // TO DO now we use modals, this should be adapted to such, and it has a part in the end of this function
          $('#add').fadeOut(350);
          $('#wait').css('display','block');
          //-------------
           var data={};
           data.authornum = authorcount;
           data.title = $('#btitle').val();
           data.newbook = 1;
           if($('#oldbook').hasClass('active')){
           data.newbook = 0;
           }
           if(authorcount>0) {
            for(var i =0;i<=authorcount;i++){
              eval("data.author"+i+"_name = $('#author"+i+"_name').val();");
            }
           }
           else {
             data.author0_name = $('#author0_name').val();
             if(!data.author0_name) {
               data.author0_name = ' ';
             }
           }
           console.log(JSON.stringify(data));
          $.ajax({
              method: "POST",
              url: "/additem/book",
              data: data
            })
              .done(function( msg ) {
                $('#btitle').val('');
                $('#author0_name').val('');
                $('#addbook').modal('hide');
                $('#wait').fadeOut(350);
                console.log(msg);
                window.location='/';
              });
          }
        });
        $('#submitmovie').click(function(){
        if($('#mtitle').val() && $('#year').val())//what if I dont know year yet?
        { // TO DO now we use modals, this should be adapted to such, and it has a part in the end of this function
          $('#add').fadeOut(350);
          $('#wait').css('display','block');
          //-------------
           var data={};
           data.title = $('#mtitle').val();
           data.newmovie = 1;
           if($('#oldmovie').hasClass('active')){
           data.newmovie = 0;
           }
           data.year = $('#year').val();
           console.log(JSON.stringify(data));
          $.ajax({
              method: "POST",
              url: "/additem/movie",
              data: data
            })
              .done(function( msg ) {
                $('#mtitle').val('');
                $('#year').val('');
                $('#addmovie').modal('hide');
                $('#wait').fadeOut(350);
                console.log(msg);
                window.location='/';
              });
          }
        });
        $('#submitarticle').click(function(){
        if($('#article_title').val() && $('#article_link').val())//what if I dont know year yet?
        { // TO DO now we use modals, this should be adapted to such, and it has a part in the end of this function
          $('#add').fadeOut(350);
          $('#wait').css('display','block');
          //-------------
           var data={};
           data.title = $('#article_title').val();
           data.newarticle = 1;
           if($('#oldarticle').hasClass('active')){
           data.newarticle = 0;
           }
           data.link = $('#article_link').val();
           console.log(JSON.stringify(data));
          $.ajax({
              method: "POST",
              url: "/additem/article",
              data: data
            })
              .done(function( msg ) {
                $('#article_title').val('');
                $('#article_link').val('');
                $('#addarticle').modal('hide');
                $('#wait').fadeOut(350);
                console.log(msg);
                window.location='/';
              });
          }
        });
        var new_messages =1;
        function notifications() {
          // TO DO when recieved a notification update user on a server and keep checking
        console.log('longpol');
        $.ajax({
              method: "POST",
              url: "/ntfc",
              data: 'tmstmp='+tmstmp+'&uid=#{user}'
            }).done(function( msg ) {
                console.log('success longpol');
               if(msg.trouble === 1)
                {
                // TO DO do somewthing here
                console.log('trouble or empty');
                notifications();
                }
                else {
                  tmstmp = msg.tmstmp;
                  if($('#notifications').length) {
                   $('#notifications').text(new_messages);
                   new_messages++;
                  }
                  else {
                    $('#chat').append('<span id="notifications" class="badge">'+new_messages+'</span>');
                    new_messages++;
                  }
                }
                notifications();
              }).fail(function(){console.log('fault longpol');setTimeout(notifications,2000);});
        }
        //notifications();

      